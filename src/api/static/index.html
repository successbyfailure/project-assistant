<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fulcrum | AI Project Manager</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6366f1">
    <link rel="icon" type="image/png" href="/static/icons/favicon.png">
    <link rel="apple-touch-icon" href="/static/icons/favicon.png">
</head>

<body>
    <div id="app" class="app-container">
        <!-- Auth View -->
        <div id="auth-view" class="auth-container">
            <div class="glass-panel auth-card">
                <div class="logo-area" style="text-align: center; margin-bottom: 30px;">
                    <img src="/static/icons/favicon.png" alt="Fulcrum Logo"
                        style="width: 64px; height: 64px; margin-bottom: 10px;">
                    <h1 id="auth-title">Welcome to Fulcrum</h1>
                    <p class="subtitle">AI-native orchestrator for your workspaces</p>
                </div>

                <form id="auth-form">
                    <div id="register-fields" class="hidden">
                        <div class="input-group">
                            <label for="full_name">Full Name</label>
                            <input type="text" id="full_name" placeholder="John Doe" autocomplete="name">
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="john@example.com" required autocomplete="username">
                    </div>
                    <div class="input-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="••••••••" required autocomplete="current-password">
                    </div>
                    <button type="submit" id="auth-submit" class="btn-primary">Login</button>
                </form>

                <div class="auth-footer" style="margin-top: 20px; text-align: center; font-size: 0.875rem;">
                    <span id="auth-toggle-text">Don't have an account?</span>
                    <a href="#" id="auth-toggle"
                        style="color: var(--accent); text-decoration: none; font-weight: 500;">Sign up</a>
                </div>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="app-layout hidden">
            <aside class="sidebar glass-panel">
                <div class="sidebar-header">
                    <img src="/static/icons/favicon.png" alt="Logo" style="width: 32px; height: 32px;">
                    <span class="logo-text">Fulcrum</span>
                </div>
                <nav class="sidebar-nav">
                    <a href="#" class="nav-item active" data-view="overview">
                        <span>Overview</span>
                    </a>
                    <a href="#" class="nav-item" data-view="chat">
                        <span>Chat with PM</span>
                    </a>
                    <a href="#" class="nav-item" data-view="projects">
                        <span>Projects</span>
                    </a>
                    <a href="#" class="nav-item" data-view="workspaces">
                        <span>Workspaces</span>
                    </a>
                    <a href="#" class="nav-item" data-view="tasks">
                        <span>Tasks</span>
                    </a>
                    <a href="#" class="nav-item" data-view="integrations">
                        <span>Integrations</span>
                    </a>
                </nav>
                <div class="sidebar-footer">
                    <button id="logout-btn" class="btn-secondary">Logout</button>
                </div>
            </aside>

            <main class="main-content">
                <!-- Overview -->
                <div id="view-overview" class="view">
                    <div class="header-action">
                        <h2>Global Overview</h2>
                        <button class="btn-primary open-project-modal" style="width: auto; padding: 10px 20px;">+ New
                            Project</button>
                    </div>

                    <div class="stats-grid">
                        <div class="glass-panel stat-card">
                            <h3>Active Projects</h3>
                            <div class="value" id="stat-projects">-</div>
                        </div>
                        <div class="glass-panel stat-card">
                            <h3>Pending Tasks</h3>
                            <div class="value" id="stat-tasks">-</div>
                        </div>
                        <div class="glass-panel stat-card">
                            <h3>LLM Status</h3>
                            <div class="value" id="stat-llm" style="font-size: 1rem; color: var(--accent);">Checking...
                            </div>
                        </div>
                    </div>

                    <h3 style="margin-top: 30px;">My Projects</h3>
                    <div id="project-list" class="project-grid" style="margin-top: 20px;">
                        <!-- Projects injected here -->
                    </div>
                </div>

                <!-- Projects -->
                <div id="view-projects" class="view hidden">
                    <div class="header-action">
                        <h2>My Projects</h2>
                        <button class="btn-primary open-project-modal" style="width: auto; padding: 10px 20px;">+
                            Register Project</button>
                    </div>
                    <div id="full-project-list" class="project-grid">
                        <!-- Full project list injected here -->
                    </div>
                </div>

                <!-- Workspaces -->
                <div id="view-workspaces" class="view hidden">
                    <div class="header-action">
                        <h2>Workspaces</h2>
                    </div>
                    <div class="integrations-grid">
                        <div class="glass-panel integration-card">
                            <div class="integration-header">
                                <div>
                                    <h3>Coder</h3>
                                    <p class="subtitle">Browse your Coder workspaces. GitHub Codespaces coming soon.</p>
                                </div>
                                <span class="integration-badge">Coder</span>
                            </div>
                            <div class="integration-section">
                                <div class="section-title">Saved Connections</div>
                                <div class="integration-row">
                                    <select id="workspaces-coder-select" class="input-select">
                                        <option value="">Select a connection...</option>
                                    </select>
                                    <button id="workspaces-coder-load" class="btn-secondary btn-compact">Load Workspaces</button>
                                </div>
                                <div id="workspaces-coder-list" class="integration-list"></div>
                            </div>
                        </div>
                        <div class="glass-panel integration-card">
                            <div class="integration-header">
                                <div>
                                    <h3>GitHub Codespaces</h3>
                                    <p class="subtitle">Connect GitHub to list Codespaces and link them to projects.</p>
                                </div>
                                <span class="integration-badge">Soon</span>
                            </div>
                            <p class="subtitle">Enable GitHub OAuth in Integrations to unlock Codespaces later.</p>
                        </div>
                    </div>
                </div>

                <!-- Chat -->
                <div id="view-chat" class="view hidden">
                    <div class="header-action">
                        <h2>Chat with ProjectManager</h2>
                        <button id="open-pm-settings" class="btn-primary" style="width: auto; padding: 10px 20px;">⚙️ PM
                            Settings</button>
                    </div>
                    <div class="glass-panel chat-container"
                        style="height: calc(100vh - 200px); display: flex; flex-direction: column;">
                        <div id="chat-messages"
                            style="flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px;">
                            <div class="message system">
                                <p>Hello! I am your Fulcrum Project Manager. How can I help you coordinate your projects
                                    today?</p>
                            </div>
                        </div>
                        <div class="chat-input-area"
                            style="padding: 20px; border-top: 1px solid var(--glass-border); display: flex; gap: 10px;">
                            <input type="text" id="chat-input" placeholder="Ask about your projects..."
                                style="flex: 1;" autocomplete="off">
                            <button id="send-chat" class="btn-primary"
                                style="width: auto; padding: 0 25px;">Send</button>
                        </div>
                    </div>
                </div>

                <!-- Tasks -->
                <div id="view-tasks" class="view hidden">
                    <div class="header-action">
                        <h2>Tasks</h2>
                    </div>
                    <div class="glass-panel" style="padding: 40px; text-align: center;">
                        <p class="subtitle">Task management integration coming soon in Phase 2.</p>
                    </div>
                </div>

                <!-- Integrations -->
                <div id="view-integrations" class="view hidden">
                    <div class="header-action">
                        <h2>Integrations</h2>
                    </div>
                    <div class="integrations-grid">
                        <div class="glass-panel integration-card">
                            <div class="integration-header">
                                <div>
                                    <h3>Coder</h3>
                                    <p class="subtitle">Connect your Coder deployment and browse your workspaces.</p>
                                </div>
                                <span class="integration-badge">Workspaces</span>
                            </div>
                            <div class="integration-section">
                                <div class="section-title">OAuth (MCP Bridge)</div>
                                <div class="integration-actions">
                                    <button type="button" id="coder-oauth-connect" class="btn-primary btn-compact">Connect via OAuth</button>
                                </div>
                                <p class="helper-text">Uses CODER_BASE_URL from the environment. Requires Coder experiments: oauth2, mcp-server-http.</p>
                            </div>
                            <div class="integration-divider"></div>
                            <div class="integration-section">
                                <div class="section-title">Saved Connections</div>
                                <div class="integration-row">
                                    <select id="coder-account-select" class="input-select">
                                        <option value="">Select a connection...</option>
                                    </select>
                                    <button id="coder-load-workspaces" class="btn-secondary btn-compact">Load Workspaces</button>
                                    <button id="coder-delete-connection" class="btn-danger btn-compact">Delete</button>
                                </div>
                                <div id="coder-workspaces" class="integration-list"></div>
                            </div>
                            <div class="integration-divider"></div>
                            <div class="integration-section">
                                <div class="section-title">Add / Update Connection</div>
                                <form id="coder-form">
                                    <div class="input-group">
                                        <label for="coder-name">Connection Name</label>
                                        <input type="text" id="coder-name" placeholder="My Coder" autocomplete="off">
                                    </div>
                                    <div class="input-group">
                                        <label for="coder-url">Coder URL</label>
                                        <input type="text" id="coder-url" placeholder="https://coder.example.com" autocomplete="url" required>
                                    </div>
                                    <div class="input-group">
                                        <label for="coder-token">Coder Token</label>
                                        <input type="password" id="coder-token" placeholder="Session or API token" autocomplete="off" required>
                                    </div>
                                    <div class="input-row">
                                        <input type="checkbox" id="coder-session-token" class="checkbox">
                                        <label for="coder-session-token" class="checkbox-label">Token is a short-lived session token (cli-auth)</label>
                                    </div>
                                    <div class="helper-text">Use cli-auth to exchange a session token for a full API key.</div>
                                    <div class="integration-actions">
                                        <button type="button" id="coder-open-cli-auth" class="btn-secondary btn-compact">Open cli-auth</button>
                                        <button type="submit" class="btn-primary btn-compact">Save Connection</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="glass-panel integration-card">
                            <div class="integration-header">
                                <div>
                                    <h3>GitHub</h3>
                                    <p class="subtitle" id="github-status-text">Not connected.</p>
                                </div>
                                <span class="integration-badge">Repositories</span>
                            </div>
                            <div class="integration-actions integration-actions-spaced">
                                <button id="github-connect" class="btn-primary btn-compact">Connect GitHub</button>
                                <button id="github-load-repos" class="btn-secondary btn-compact">Load Repos</button>
                            </div>
                            <div id="github-repos" class="integration-list"></div>
                        </div>

                        <div class="glass-panel integration-card">
                            <div class="integration-header">
                                <div>
                                    <h3>AI Accounts & Credentials</h3>
                                    <p class="subtitle">Your configured AI credentials.</p>
                                </div>
                                <span class="integration-badge">Accounts</span>
                            </div>
                            <div id="accounts-list" class="integration-list">
                                <!-- Accounts will be loaded here -->
                            </div>
                        </div>

                        <div class="glass-panel integration-card">
                            <div class="integration-header">
                                <div>
                                    <h3>Configure LLM</h3>
                                    <p class="subtitle">Add your AI provider credentials. Model selection happens in Project Manager settings.</p>
                                </div>
                                <span class="integration-badge">LLM</span>
                            </div>
                            <form id="llm-form">
                                <div class="input-group">
                                    <label for="llm-name">Configuration Name</label>
                                    <input type="text" id="llm-name" placeholder="My Ollama / OpenAI Key" autocomplete="off">
                                </div>
                                <div class="input-group">
                                    <label for="llm-provider">Provider</label>
                                    <select id="llm-provider" class="input-select">
                                        <option value="openai">OpenAI (Default)</option>
                                        <option value="anthropic">Anthropic</option>
                                        <option value="azure">Azure OpenAI</option>
                                        <option value="ollama">Ollama.com</option>
                                        <option value="ollama-local">Ollama Self-hosted</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="llm-endpoint">Custom API Endpoint (Optional)</label>
                                    <input type="text" id="llm-endpoint" placeholder="https://api.openai.com/v1" autocomplete="url">
                                </div>
                                <div class="input-group">
                                    <label for="llm-models">Enabled Models</label>
                                    <select id="llm-models" multiple class="input-select">
                                        <option value="">Load models from endpoint...</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="llm-model-default">Default Model</label>
                                    <select id="llm-model-default" class="input-select">
                                        <option value="">Select default model...</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="llm-key">API Key <span class="inline-note">(Optional for Ollama self-hosted)</span></label>
                                    <input type="password" id="llm-key" placeholder="sk-... or leave empty for Ollama" autocomplete="off">
                                </div>
                                <div class="input-row">
                                    <input type="checkbox" id="llm-global" class="checkbox">
                                    <label for="llm-global" class="checkbox-label">Make System Wide (Admin only)</label>
                                </div>
                                <button type="submit" class="btn-primary" style="margin-top: 12px;">Save Credentials</button>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Project Modal -->
        <div id="project-modal" class="modal-overlay hidden"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px);">
            <div class="glass-panel modal-card"
                style="width: 100%; max-width: 500px; padding: 40px; position: relative;">
                <h2>New Project</h2>
                <p class="subtitle">Register a project for AI-native management.</p>
                <form id="project-form" style="margin-top: 20px;">
                    <div class="input-group">
                        <label for="p-name">Project Name</label>
                        <input type="text" id="p-name" placeholder="E.g. Project Assistant" required autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label for="p-desc">Description</label>
                        <input type="text" id="p-desc" placeholder="What is this project about?" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label for="p-url">Repository URL (Optional)</label>
                        <input type="text" id="p-url" placeholder="https://github.com/user/repo" autocomplete="url">
                    </div>
                    <div class="input-group">
                        <label for="p-workspace">Workspace ID (Optional)</label>
                        <input type="text" id="p-workspace" placeholder="Coder workspace id or Codespace id" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label for="p-path">Workspace Path (Optional)</label>
                        <input type="text" id="p-path" placeholder="/home/coder/Projects/YourProject" autocomplete="off">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button type="button" class="btn-primary"
                            style="background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-dim);"
                            onclick="document.getElementById('project-modal').classList.add('hidden')">Cancel</button>
                        <button type="submit" class="btn-primary" style="flex: 1;">Create Project</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Project Viewer -->
        <div id="project-viewer-modal" class="modal-overlay hidden"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px);">
            <div class="glass-panel modal-card"
                style="width: 100%; max-width: 1100px; padding: 32px; position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px;">
                    <div>
                        <h2 id="project-viewer-title">Project</h2>
                        <p class="subtitle" id="project-viewer-desc">Project details</p>
                    </div>
                    <button type="button" id="project-viewer-close" class="btn-secondary btn-compact">Close</button>
                </div>
                <div class="project-viewer-grid">
                    <div class="project-viewer-pane">
                        <div class="section-title">Project Viewer</div>
                        <img id="project-viewer-thumb" class="project-viewer-thumb hidden" alt="Project thumbnail">
                        <div class="project-viewer-placeholder">
                            Project viewer will appear here.
                        </div>
                    </div>
                    <div class="project-viewer-pane">
                        <div class="section-title">Configuration</div>
                        <form id="project-settings-form">
                            <div class="input-group">
                                <label for="project-workspace-account">Coder Connection</label>
                                <select id="project-workspace-account" class="input-select">
                                    <option value="">Select a connection...</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="project-workspace-select">Workspace</label>
                                <div class="integration-row">
                                    <select id="project-workspace-select" class="input-select">
                                        <option value="">Select a workspace...</option>
                                    </select>
                                    <button type="button" id="project-workspace-load" class="btn-secondary btn-compact">Load</button>
                                </div>
                                <div id="project-workspace-status" class="helper-text"></div>
                            </div>
                            <div class="input-group">
                                <label for="project-workspace-path">Workspace Path</label>
                                <div class="integration-row">
                                    <input type="text" id="project-workspace-path" placeholder="/home/coder/Projects/YourProject" autocomplete="off">
                                    <button type="button" id="project-browse-path" class="btn-secondary btn-compact">Browse</button>
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="project-git-url">Git URL</label>
                                <input type="text" id="project-git-url" placeholder="https://github.com/org/repo" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label for="project-prod-url">Production URL</label>
                                <input type="text" id="project-prod-url" placeholder="https://app.example.com" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label for="project-test-url">Testing URL</label>
                                <input type="text" id="project-test-url" placeholder="https://staging.example.com" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label for="project-thumbnail-url">Thumbnail URL</label>
                                <input type="text" id="project-thumbnail-url" placeholder="https://cdn.example.com/thumb.png" autocomplete="off">
                            </div>
                            <button type="submit" class="btn-primary" style="margin-top: 12px;">Save Settings</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Path Selector -->
        <div id="project-path-modal" class="modal-overlay hidden"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px);">
            <div class="glass-panel modal-card"
                style="width: 100%; max-width: 720px; padding: 28px; position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px;">
                    <div>
                        <h3>Select Folder</h3>
                        <p class="subtitle" id="project-path-current">/</p>
                    </div>
                    <button type="button" id="project-path-close" class="btn-secondary btn-compact">Close</button>
                </div>
                <div id="project-path-alert" class="workspace-alert hidden">
                    <div id="project-path-alert-text" class="workspace-alert-text"></div>
                    <button type="button" id="project-path-open-coder" class="btn-primary btn-compact">Open in Coder</button>
                </div>
                <div id="project-path-list" class="folder-list"></div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 16px;">
                    <button type="button" id="project-path-use" class="btn-primary btn-compact">Use This Folder</button>
                </div>
            </div>
        </div>

        <!-- PM Settings Modal -->
        <div id="pm-settings-modal" class="modal-overlay hidden"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px);">
            <div class="glass-panel modal-card"
                style="width: 100%; max-width: 500px; padding: 40px; position: relative;">
                <h2>Project Manager Settings</h2>
                <p class="subtitle">Configure which AI model to use for chat.</p>
                <form id="pm-settings-form" style="margin-top: 20px;">
                    <div class="input-group">
                        <label for="pm-account">AI Account</label>
                        <select id="pm-account"
                            style="width: 100%; background: rgba(15, 23, 42, 0.5); border: 1px solid var(--glass-border); border-radius: 12px; padding: 14px; color: white;"
                            required>
                            <option value="">Select an account...</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="pm-model">Model</label>
                        <select id="pm-model"
                            style="width: 100%; background: rgba(15, 23, 42, 0.5); border: 1px solid var(--glass-border); border-radius: 12px; padding: 14px; color: white;"
                            required>
                            <option value="">Select account first...</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button type="button" class="btn-primary"
                            style="background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-dim);"
                            onclick="document.getElementById('pm-settings-modal').classList.add('hidden')">Cancel</button>
                        <button type="submit" class="btn-primary" style="flex: 1;">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Account Edit Modal -->
        <div id="account-edit-modal" class="modal-overlay hidden"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px);">
            <div class="glass-panel modal-card"
                style="width: 100%; max-width: 520px; padding: 40px; position: relative;">
                <h2>Edit AI Account</h2>
                <p class="subtitle">Update endpoint and default model for this account.</p>
                <form id="account-edit-form" style="margin-top: 20px;">
                    <div class="input-group">
                        <label for="account-edit-name">Account Name</label>
                        <input type="text" id="account-edit-name" placeholder="My AI Account" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label for="account-edit-endpoint">API Endpoint</label>
                        <input type="text" id="account-edit-endpoint" placeholder="https://api.openai.com/v1" autocomplete="url">
                    </div>
                    <div class="input-group">
                        <label for="account-edit-models">Enabled Models</label>
                        <select id="account-edit-models" multiple
                            style="width: 100%; background: rgba(15, 23, 42, 0.5); border: 1px solid var(--glass-border); border-radius: 12px; padding: 14px; color: white;">
                            <option value="">Load models...</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="account-edit-model-default">Default Model</label>
                        <select id="account-edit-model-default"
                            style="width: 100%; background: rgba(15, 23, 42, 0.5); border: 1px solid var(--glass-border); border-radius: 12px; padding: 14px; color: white;">
                            <option value="">Select default model...</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button type="button" class="btn-primary"
                            style="background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-dim);"
                            onclick="document.getElementById('account-edit-modal').classList.add('hidden')">Cancel</button>
                        <button type="submit" class="btn-primary" style="flex: 1;">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js');
            });
        }
    </script>
</body>

</html>
